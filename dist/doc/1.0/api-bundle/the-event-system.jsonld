{"@context":"http://schema.org","@type":"CreativeWork","name":"The event system","text":"\u003ch1\u003eThe event system\u003c/h1\u003e\n\n\u003cp\u003eDunglasApiBundle leverages the \u003ca href=\"http://symfony.com/doc/current/components/event_dispatcher/index.html\"\u003eSymfony Event Dispatcher Component\u003c/a\u003e\nto provide a powerful event system triggered in the object lifecycle.\u003c/p\u003e\n\n\u003cp\u003eApart from the \u003ca href=\"http://symfony.com/doc/current/components/http_kernel/introduction.html#creating-an-event-listener\"\u003eevents triggered by the Symfony HTTP Kernel\u003c/a\u003e\nand \u003ca href=\"http://doctrine-orm.readthedocs.org/en/latest/reference/events.html#reference-events-lifecycle-events\"\u003eby Doctrine\u003c/a\u003e\n(if you use it), DunglasApiBundle comes with its own set of events occurring during the handling of the request:\u003c/p\u003e\n\n\u003ch2\u003eRetrieving a list\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.retrieve_list\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::RETRIEVE_LIST\u003c/code\u003e): occurs after retrieving a list of objects during a \u003ccode\u003eGET\u003c/code\u003e request on a collection.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003eRetrieving an item\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.retrieve\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::RETRIEVE\u003c/code\u003e): occurs after retrieving an object during a \u003ccode\u003eGET\u003c/code\u003e request on an item.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003eCreating an item\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.pre_create_validation\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::PRE_CREATE_VALIDATION\u003c/code\u003e): occurs before the object validation during a \u003ccode\u003ePOST\u003c/code\u003e request.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi.pre_create\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::PRE_CREATE\u003c/code\u003e): occurs after the object validation and before it is persisted during a \u003ccode\u003ePOST\u003c/code\u003e request.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi.post_create\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::POST_CREATE\u003c/code\u003e): occurs after the object is persisted during \u003ccode\u003ePOST\u003c/code\u003e request.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003eUpdating an item\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.pre_update_validation\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::PRE_UPDATE_VALIDATION\u003c/code\u003e): occurs before the object validation during a \u003ccode\u003ePUT\u003c/code\u003e request.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi.pre_update\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::PRE_UPDATE\u003c/code\u003e): occurs after the object validation and before it is persisted during a \u003ccode\u003ePUT\u003c/code\u003e request.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi.post_update\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::POST_UPDATE\u003c/code\u003e): occurs after the object is persisted during a \u003ccode\u003ePUT\u003c/code\u003e request.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003eDeleting an item\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.pre_delete\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::PRE_DELETE\u003c/code\u003e): occurs before the object deletion during a \u003ccode\u003eDELETE\u003c/code\u003e request.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi.post_delete\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\Event\\Events::POST_DELETE\u003c/code\u003e): occurs after the object deletion during a \u003ccode\u003eDELETE\u003c/code\u003e request.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e## JSON-LD context builder\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi.json_ld.context_builder\u003c/code\u003e (\u003ccode\u003eDunglas\\ApiBundle\\JsonLd\\Event\\Events::CONTEXT_BUILDER\u003c/code\u003e): occurs after the initialization of the context and lets you extend the context. The \u003ccode\u003eEvent\u003c/code\u003e object is an instance of \u003ccode\u003eDunglas\\ApiBundle\\JsonLd\\Event\\ContextBuilderEvent\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003eRegistering an event listener\u003c/h2\u003e\n\n\u003cp\u003eIn the following example, we register an event listener that will be called after every new object is created:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003e\u0026lt;?php\n\n// src/AppBundle/EventListener/MyEventListener.php\n\nnamespace AppBundle\\EventListener;\n\nuse AppBundle\\Entity\\MyObject;\nuse Doctrine\\Common\\Persistence\\ManagerRegistry;\nuse Dunglas\\ApiBundle\\Event\\DataEvent;\n\nclass MyEventListener\n{\n    /**\n     * @param DataEvent $event\n     */\n    public function onPostCreate(DataEvent $event)\n    {\n        $data = $event-\u0026gt;getData();\n\n        if ($data instanceof MyObject) {\n            $resource = $event-\u0026gt;getResource(); // Get the related instance of Dunglas\\ApiBundle\\Api\\ResourceInterface\n\n            // Do something awesome here\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e# app/config/services.yml\n\nservices:\n    my_event_listener:\n        class: \u0026#34;AppBundle\\EventListener\\MyEventListener\u0026#34;\n        tags:  [ { name: \u0026#34;kernel.event_listener\u0026#34;, event: \u0026#34;api.post_create\u0026#34;, method: \u0026#34;onPostCreate\u0026#34; } ]\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ePrevious chapter: \u003ca href=\"validation.jsonld\"\u003eValidation\u003c/a\u003e\u003cbr/\u003e\nNext chapter: \u003ca href=\"resources.jsonld\"\u003eResources\u003c/a\u003e\u003c/p\u003e\n","author":[{"@type":"Person","Name":"Kévin Dunglas","email":"dunglas@gmail.com"},{"@type":"Person","Name":"Ruben Kruiswijk","email":"ruben.kruiswijk@skydreams.nl"},{"@type":"Person","Name":"Kevin Saliou","email":"kevin@saliou.name"}],"dateCreated":"2015-09-04T11:55:15+02:00","dateModified":"2016-05-21T17:49:17+02:00"}